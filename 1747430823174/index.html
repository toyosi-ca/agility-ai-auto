<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        #game-canvas {
            display: none; /* Hidden by default */
        }
        #start-screen, #end-screen, #instructions {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="start-screen">
        <h1>Pong</h1>
        <button id="play-button">Play</button>
        <button id="instructions-button">Instructions</button>
    </div>
    <canvas id="game-canvas" width="800" height="600"></canvas>
    <div id="end-screen">
        <h2 id="winner"></h2>
        <button id="play-again-button">Play Again</button>
    </div>
    <div id="instructions">
        <h2>Instructions</h2>
        <p>Player 1: W (up), S (down)</p>
        <p>Player 2: ↑ (up), ↓ (down)</p>
        <button id="back-to-start-button">Back to Start</button>
    </div>
    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const instructionsScreen = document.getElementById('instructions');
        const winnerText = document.getElementById('winner');
        const playButton = document.getElementById('play-button');
        const playAgainButton = document.getElementById('play-again-button');
        const instructionsButton = document.getElementById('instructions-button');
        const backToStartButton = document.getElementById('back-to-start-button');

        let paddleWidth = 10, paddleHeight = 100;
        let player1Y = (canvas.height - paddleHeight) / 2, player2Y = (canvas.height - paddleHeight) / 2;
        let ballX = canvas.width / 2, ballY = canvas.height / 2, ballRadius = 10;
        let ballSpeedX = 5, ballSpeedY = 5;
        let player1Score = 0, player2Score = 0;
        let winningScore = getWinningScore();
        let isGameRunning = false;

        playButton.addEventListener('click', startGame);
        playAgainButton.addEventListener('click', resetGame);
        instructionsButton.addEventListener('click', showInstructions);
        backToStartButton.addEventListener('click', backToStart);

        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case 'w':
                    if (player1Y > 0) player1Y -= 10;
                    break;
                case 's':
                    if (player1Y < canvas.height - paddleHeight) player1Y += 10;
                    break;
                case 'ArrowUp':
                    if (player2Y > 0) player2Y -= 10;
                    break;
                case 'ArrowDown':
                    if (player2Y < canvas.height - paddleHeight) player2Y += 10;
                    break;
            }
        });

        function startGame() {
            winningScore = getWinningScore();
            player1Score = 0;
            player2Score = 0;
            isGameRunning = true;
            canvas.style.display = 'block';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            instructionsScreen.style.display = 'none';
            gameLoop();
        }

        function resetGame() {
            startGame();
        }

        function showInstructions() {
            isGameRunning = false;
            startScreen.style.display = 'none';
            instructionsScreen.style.display = 'flex';
        }

        function backToStart() {
            instructionsScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        }

        function gameLoop() {
            if (!isGameRunning) return;

            updateGame();
            drawGame();

            if (player1Score < winningScore && player2Score < winningScore) {
                requestAnimationFrame(gameLoop);
            } else {
                endGame();
            }
        }

        function updateGame() {
            ballX += ballSpeedX;
            ballY += ballSpeedY;

            if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
                ballSpeedY = -ballSpeedY;
            }

            if (ballX - ballRadius < paddleWidth && ballY > player1Y && ballY < player1Y + paddleHeight) {
                ballSpeedX = -ballSpeedX;
            }

            if (ballX + ballRadius > canvas.width - paddleWidth && ballY > player2Y && ballY < player2Y + paddleHeight) {
                ballSpeedX = -ballSpeedX;
            }

            if (ballX + ballRadius < 0) {
                player2Score++;
                resetBall();
            }
            if (ballX - ballRadius > canvas.width) {
                player1Score++;
                resetBall();
            }
        }

        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.fillRect(0, player1Y, paddleWidth, paddleHeight);
            ctx.fillRect(canvas.width - paddleWidth, player2Y, paddleWidth, paddleHeight);
            ctx.beginPath();
            ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.font = '24px Arial';
            ctx.fillText(`Player 1: ${player1Score}`, 50, 50);
            ctx.fillText(`Player 2: ${player2Score}`, canvas.width - 150, 50);
        }

        function resetBall() {
            ballX = canvas.width / 2;
            ballY = canvas.height / 2;
            ballSpeedX = -ballSpeedX;
        }

        function endGame() {
            isGameRunning = false;
            canvas.style.display = 'none';
            endScreen.style.display = 'flex';
            winnerText.textContent = player1Score === winningScore ? 'Player 1 Wins!' : 'Player 2 Wins!';
        }

        function setWinningScore(score) {
            localStorage.setItem('winningScore', score);
        }

        function getWinningScore() {
            return parseInt(localStorage.getItem('winningScore')) || 5; // Default score is 5
        }
    </script>
</body>
</html>